<!DOCTYPE html>
<html lang="vi" xmlns:th="http://www.thymeleaf.org"
      th:replace="~{admin/layout :: layout(#{admin.activity.logs.title}, ~{::content}, 'sidebar-mini')}">
<head></head>
<body>
<th:block th:fragment="content">
    <div class="content-header">
        <div class="container-fluid">
            <div class="row mb-2">
                <div class="col-sm-6">
                    <h1 class="m-0" th:text="#{admin.activity.logs.title}">Activity Logs</h1>
                </div>
            </div>
        </div>
    </div>

    <section class="content">
        <div class="container-fluid">
            <!-- Flash Messages -->
            <div th:if="${error}" class="alert alert-danger alert-dismissible fade show">
                <button type="button" class="close" data-dismiss="alert">&times;</button>
                <span th:text="${error}"></span>
            </div>
            <div th:if="${success}" class="alert alert-success alert-dismissible fade show">
                <button type="button" class="close" data-dismiss="alert">&times;</button>
                <span th:text="${success}"></span>
            </div>

            <!-- Filters Card -->
            <div class="card">
                <div class="card-body">
                    <form method="get" th:action="@{/admin/activity-logs}">
                        <div class="row">
                            <div class="col-md-3">
                                <div class="form-group">
                                    <label for="userId" th:text="#{admin.activity.logs.filter.user}">User ID</label>
                                    <input type="number" class="form-control" id="userId" name="userId"
                                           th:value="${filter.userId}" th:placeholder="#{admin.activity.logs.filter.placeholder.user.id}">
                                </div>
                            </div>
                            <div class="col-md-3">
                                <div class="form-group">
                                    <label for="action" th:text="#{admin.activity.logs.filter.action}">Action</label>
                                    <select class="form-control" id="action" name="action">
                                        <option value="" th:text="#{admin.activity.logs.filter.all.actions}">All Actions</option>
                                        <option th:each="actionType : ${actionTypes}"
                                                th:value="${actionType}"
                                                th:text="${actionType}"
                                                th:selected="${filter.action == actionType}">
                                        </option>
                                    </select>
                                </div>
                            </div>
                            <div class="col-md-3">
                                <div class="form-group">
                                    <label for="entityType" th:text="#{admin.activity.logs.filter.entity.type}">Entity Type</label>
                                    <input type="text" class="form-control" id="entityType" name="entityType"
                                           th:value="${filter.entityType}" th:placeholder="#{admin.activity.logs.filter.placeholder.entity.type}">
                                </div>
                            </div>
                            <div class="col-md-3">
                                <div class="form-group">
                                    <label for="startDate" th:text="#{admin.activity.logs.filter.start.date}">Start Date</label>
                                    <input type="date" class="form-control" id="startDate" name="startDate"
                                           th:value="${filter.startDate}">
                                </div>
                            </div>
                        </div>
                        <div class="row">
                            <div class="col-md-3">
                                <div class="form-group">
                                    <label for="endDate" th:text="#{admin.activity.logs.filter.end.date}">End Date</label>
                                    <input type="date" class="form-control" id="endDate" name="endDate"
                                           th:value="${filter.endDate}">
                                </div>
                            </div>
                            <div class="col-md-9">
                                <div class="form-group">
                                    <label>&nbsp;</label><br/>
                                    <button type="submit" class="btn btn-primary">
                                        <i class="fas fa-search"></i> <span th:text="#{admin.activity.logs.filter.button.filter}">Filter</span>
                                    </button>
                                    <a th:href="@{/admin/activity-logs}" class="btn btn-secondary">
                                        <i class="fas fa-undo"></i> <span th:text="#{admin.activity.logs.filter.button.clear}">Clear</span>
                                    </a>
                                </div>
                            </div>
                        </div>
                    </form>
                </div>
            </div>

            <!-- Activity Logs Table Card -->
            <div class="card">
                <div class="card-body">
                    <div class="table-responsive">
                        <table class="table table-striped table-hover">
                            <thead>
                                <tr>
                                    <th th:text="#{admin.activity.logs.table.header.id}">ID</th>
                                    <th th:text="#{admin.activity.logs.table.header.timestamp}">Timestamp</th>
                                    <th th:text="#{admin.activity.logs.table.header.action}">Action</th>
                                    <th th:text="#{admin.activity.logs.table.header.user}">User</th>
                                    <th th:text="#{admin.activity.logs.table.header.entity}">Entity</th>
                                    <th th:text="#{admin.activity.logs.table.header.description}">Description</th>
                                    <th th:text="#{admin.activity.logs.table.header.ip.address}">IP Address</th>
                                    <th th:text="#{admin.activity.logs.table.header.actions}">Actions</th>
                                </tr>
                            </thead>
                            <tbody>
                                <tr th:if="${#lists.isEmpty(logs)}">
                                    <td colspan="8" class="text-center text-muted" th:text="#{admin.activity.logs.no.data}">No activity logs found</td>
                                </tr>
                                <tr th:each="log : ${logs}">
                                    <td th:text="${log.id}">1</td>
                                    <td>
                                        <small th:text="${#temporals.format(log.createdAt, 'yyyy-MM-dd')}">2025-01-01</small><br/>
                                        <small class="text-muted" th:text="${#temporals.format(log.createdAt, 'HH:mm:ss')}">10:00:00</small>
                                    </td>
                                    <td>
                                        <span th:class="${'badge ' +
                                                         (log.action.name() == 'LOGIN' ? 'badge-success' :
                                                          log.action.name() == 'LOGOUT' ? 'badge-secondary' :
                                                          log.action.name() == 'CREATE' ? 'badge-primary' :
                                                          log.action.name() == 'UPDATE' ? 'badge-info' :
                                                          log.action.name() == 'DELETE' ? 'badge-danger' : 'badge-secondary')}"
                                              th:text="${log.action}">LOGIN</span>
                                    </td>
                                    <td>
                                        <div th:if="${log.userName}">
                                            <strong th:text="${log.userName}">User Name</strong><br/>
                                            <small class="text-muted" th:text="${log.userEmail}">email@example.com</small>
                                        </div>
                                        <span th:unless="${log.userName}" class="text-muted"><i th:text="#{admin.activity.logs.system}">System</i></span>
                                    </td>
                                    <td>
                                        <span th:if="${log.entityType}">
                                            <strong th:text="${log.entityType}">Expense</strong><br/>
                                            <small class="text-muted">#<span th:text="${log.entityId}">123</span></small>
                                        </span>
                                        <span th:unless="${log.entityType}" class="text-muted">-</span>
                                    </td>
                                    <td th:text="${log.description}">Description</td>
                                    <td>
                                        <small class="text-muted" th:text="${log.ipAddress} ?: '-'">192.168.1.1</small>
                                    </td>
                                    <td>
                                        <a th:href="@{'/admin/activity-logs/' + ${log.id}}"
                                           class="btn btn-sm btn-info"
                                           th:title="#{admin.common.view.detail}">
                                            <i class="fas fa-eye"></i>
                                        </a>
                                        <form th:action="@{'/admin/activity-logs/' + ${log.id}}"
                                              method="post"
                                              style="display:inline-block;"
                                              th:onsubmit="|return confirm('#{admin.activity.log.confirm.delete}')|">
                                            <input type="hidden" name="_method" value="DELETE"/>
                                            <button type="submit" class="btn btn-sm btn-danger" th:title="#{admin.common.delete}">
                                                <i class="fas fa-trash"></i>
                                            </button>
                                        </form>
                                    </td>
                                </tr>
                            </tbody>
                        </table>
                    </div>
                    <!-- Pagination -->
                <th:block th:replace="~{fragments/pagination :: activityLogsPagination(${currentPage}, ${totalPages}, ${totalElements}, ${filter.size}, ${filter.userId}, ${filter.action}, ${filter.entityType}, ${filter.startDate}, ${filter.endDate})}"></th:block>
                </div>

            </div>
        </div>
    </section>
</th:block>
</body>
</html>
