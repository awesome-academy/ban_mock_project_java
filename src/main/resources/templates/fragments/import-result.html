<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org"
      th:fragment="import-result-modal">
<head>
    <meta charset="UTF-8">
</head>
<body>

<!-- Import Result Modal -->
<div class="modal fade" id="importResultModal" tabindex="-1" role="dialog" aria-labelledby="importResultModalLabel" aria-hidden="true" th:if="${importResult != null}">
    <div class="modal-dialog modal-lg" role="document">
        <div class="modal-content">
            <div class="modal-header" th:classappend="${importResult.hasErrors()} ? 'bg-warning' : 'bg-success'">
                <h5 class="modal-title" id="importResultModalLabel">
                    <i class="fas" th:classappend="${importResult.hasErrors()} ? 'fa-exclamation-triangle' : 'fa-check-circle'"></i>
                    <span th:text="#{label.import.result}">Import Result</span>
                </h5>
                <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                    <span aria-hidden="true">&times;</span>
                </button>
            </div>
            <div class="modal-body">
                <!-- Summary -->
                <div class="row mb-3">
                    <div class="col-md-4">
                        <div class="info-box">
                            <span class="info-box-icon bg-info"><i class="fas fa-file-csv"></i></span>
                            <div class="info-box-content">
                                <span class="info-box-text" th:text="#{label.total.rows}">Total Rows</span>
                                <span class="info-box-number" th:text="${importResult.totalRows}">0</span>
                            </div>
                        </div>
                    </div>
                    <div class="col-md-4">
                        <div class="info-box">
                            <span class="info-box-icon bg-success"><i class="fas fa-check"></i></span>
                            <div class="info-box-content">
                                <span class="info-box-text" th:text="#{label.success}">Success</span>
                                <span class="info-box-number" th:text="${importResult.successCount}">0</span>
                            </div>
                        </div>
                    </div>
                    <div class="col-md-4">
                        <div class="info-box">
                            <span class="info-box-icon bg-danger"><i class="fas fa-times"></i></span>
                            <div class="info-box-content">
                                <span class="info-box-text" th:text="#{label.errors}">Errors</span>
                                <span class="info-box-number" th:text="${importResult.errorCount}">0</span>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Error Details -->
                <div th:if="${importResult.hasErrors()}">
                    <h6 class="text-danger"><i class="fas fa-exclamation-circle"></i> <span th:text="#{label.error.details}">Error Details</span>:</h6>
                    <div class="table-responsive" style="max-height: 400px; overflow-y: auto;">
                        <table class="table table-sm table-bordered table-hover">
                            <thead class="thead-light sticky-top">
                                <tr>
                                    <th style="width: 80px;" th:text="#{label.line.number}">Line #</th>
                                    <th th:text="#{label.error.message}">Error Message</th>
                                    <th th:text="#{label.line.content}">Line Content</th>
                                </tr>
                            </thead>
                            <tbody>
                                <tr th:each="error : ${importResult.errors}">
                                    <td class="text-center"><span class="badge badge-danger" th:text="${error.lineNumber}">1</span></td>
                                    <td><span class="text-danger" th:text="${error.errorMessage}">Error message</span></td>
                                    <td><code class="text-muted" style="font-size: 0.85em; white-space: nowrap; overflow: hidden; text-overflow: ellipsis; display: block;" th:text="${error.lineContent}">Line content</code></td>
                                </tr>
                            </tbody>
                        </table>
                    </div>
                </div>

                <!-- Success Message -->
                <div th:unless="${importResult.hasErrors()}" class="alert alert-success">
                    <i class="fas fa-check-circle"></i>
                    <span th:text="#{label.import.all.success}">All records imported successfully!</span>
                </div>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" data-dismiss="modal" th:text="#{label.action.close}">Close</button>
            </div>
        </div>
    </div>
</div>

<script th:if="${importResult != null && importResult.hasErrors()}">
    document.addEventListener('DOMContentLoaded', function() {
        if (typeof jQuery !== 'undefined') {
            jQuery('#importResultModal').modal('show');
        }
    });
</script>

</body>
</html>
